#!/bin/sh

echo "ğŸ” Running pre-commit checks..."

# å‰ç«¯æ£€æŸ¥
echo "ğŸ“¦ Checking frontend..."

# TypeScript æ£€æŸ¥
echo "  â†’ TypeScript check..."
npx tsc --noEmit
if [ $? -ne 0 ]; then
    echo "âŒ TypeScript check failed!"
    exit 1
fi

# ESLint æ£€æŸ¥
echo "  â†’ ESLint check..."
npm run lint
if [ $? -ne 0 ]; then
    echo "âŒ ESLint check failed!"
    exit 1
fi

# Prettier æ£€æŸ¥
echo "  â†’ Prettier check..."
npx prettier --check "src/**/*.{ts,tsx,css}"
if [ $? -ne 0 ]; then
    echo "âŒ Prettier check failed! Run 'npm run format' to fix."
    exit 1
fi

# Rust æ£€æŸ¥
echo "ğŸ¦€ Checking Rust..."

# Rust æ ¼å¼æ£€æŸ¥
echo "  â†’ Rust format check..."
cd src-tauri
cargo fmt --all -- --check
if [ $? -ne 0 ]; then
    echo "âŒ Rust format check failed! Run 'cargo fmt' in src-tauri to fix."
    exit 1
fi

# Rust ç¼–è¯‘æ£€æŸ¥ (ä¸ä½¿ç”¨ä¸¥æ ¼çš„ clippy)
echo "  â†’ Rust build check..."
cargo check --all-targets
if [ $? -ne 0 ]; then
    echo "âŒ Rust build check failed!"
    exit 1
fi

cd ..

echo "âœ… All pre-commit checks passed!"
